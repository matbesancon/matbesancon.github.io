<!DOCTYPE html>
<html lang="en-ca">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Mathieu Besançon">

  
  
  
    
  
  <meta name="description" content="In various graph-related algorithms, a graph is modified through successive operations, merging, creating and deleting vertices. That&rsquo;s the case for the Blossom algorithm finding a best matching in a graph and using contractions of nodes. In such cases, it can be useful to remove only the vertex being contracted, and maintain the number of all other vertices.
LightGraphs.jl offers a set of abstractions, types and algorithms to get started with graphs.">

  
  <link rel="alternate" hreflang="en-ca" href="https://matbesancon.github.io/post/2019-05-30-vertex-safe-removal/">

  


  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/monokai.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/monokai.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.11bfb5db527d0300a83b31a367badc35.css">

  

  
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://matbesancon.github.io/post/2019-05-30-vertex-safe-removal/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@matbesancon">
  <meta property="twitter:creator" content="@matbesancon">
  
  <meta property="og:site_name" content="μβ">
  <meta property="og:url" content="https://matbesancon.github.io/post/2019-05-30-vertex-safe-removal/">
  <meta property="og:title" content="Vertex removal in LightGraphs | μβ">
  <meta property="og:description" content="In various graph-related algorithms, a graph is modified through successive operations, merging, creating and deleting vertices. That&rsquo;s the case for the Blossom algorithm finding a best matching in a graph and using contractions of nodes. In such cases, it can be useful to remove only the vertex being contracted, and maintain the number of all other vertices.
LightGraphs.jl offers a set of abstractions, types and algorithms to get started with graphs."><meta property="og:image" content="https://matbesancon.github.io/img/icon-192.png">
  <meta property="twitter:image" content="https://matbesancon.github.io/img/icon-192.png"><meta property="og:locale" content="en-ca">
  
  <meta property="article:published_time" content="2019-05-30T11:14:43&#43;02:00">
  
  <meta property="article:modified_time" content="2020-01-06T16:40:51&#43;01:00">
  

  


  





  <title>Vertex removal in LightGraphs | μβ</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">μβ</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Vertex removal in LightGraphs</h1>

  
  <p class="page-subtitle">Testing abstractions, their limits and leaks</p>
  

  
    



<meta content="2019-05-30 11:14:43 &#43;0200 CEST" itemprop="datePublished">
<meta content="2020-01-06 16:40:51 &#43;0100 CET" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    <time>2020-01-06</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    6 min read
  </span>
  

  
  

  
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://matbesancon.github.io/post/2019-05-30-vertex-safe-removal/&amp;text=Vertex%20removal%20in%20LightGraphs" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://matbesancon.github.io/post/2019-05-30-vertex-safe-removal/&amp;t=Vertex%20removal%20in%20LightGraphs" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Vertex%20removal%20in%20LightGraphs&amp;body=https://matbesancon.github.io/post/2019-05-30-vertex-safe-removal/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://matbesancon.github.io/post/2019-05-30-vertex-safe-removal/&amp;title=Vertex%20removal%20in%20LightGraphs" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Vertex%20removal%20in%20LightGraphs%20https://matbesancon.github.io/post/2019-05-30-vertex-safe-removal/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://matbesancon.github.io/post/2019-05-30-vertex-safe-removal/&amp;title=Vertex%20removal%20in%20LightGraphs" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <p>In various graph-related algorithms, a graph is modified through successive
operations, merging, creating and deleting vertices. That&rsquo;s the case for the
<a href="https://en.wikipedia.org/wiki/Blossom_algorithm">Blossom algorithm</a> finding a
best matching in a graph and using contractions of nodes.
In such cases, it can be useful to remove only the vertex being contracted,
and maintain the number of all other vertices.</p>
<p><em>LightGraphs.jl</em> offers a set of abstractions, types and algorithms to get started
with graphs. The claim of the abstraction is simple: whatever the underlying
structure representing your graph, if it implements the <code>AbstractGraph</code> interface,
it can be used out of the box with all algorithms built on <em>LightGraphs.jl</em>.
The main concrete type presented by <em>LightGraphs.jl</em> is <code>SimpleGraph</code> and its
directed counterpart <code>SimpleDiGraph</code>, only storing edges as adjacency lists,
meaning vertices are just the integers from 1 to the length of the list.
This means that in a graph with 6 vertices, deleting vertex 4 will re-label vertex 6
as 4. Hopefully, the interface should allow us to build a graph type on top of another graph,
re-implementing only vertex removal.</p>
<h2 id="a-simple-vertex-safe-implementation">A simple vertex-safe implementation</h2>
<p>First things first, we will build it as a struct, using LightGraphs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">import</span> LightGraphs
<span style="color:#66d9ef">const</span> LG <span style="color:#f92672">=</span> LightGraphs

<span style="color:#66d9ef">struct</span> VSafeGraph{T, G<span style="color:#f92672">&lt;:</span>LG<span style="color:#f92672">.</span>AbstractGraph{T}, V<span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">AbstractVector</span>{<span style="color:#66d9ef">Int</span>}} <span style="color:#f92672">&lt;:</span> LG<span style="color:#f92672">.</span>AbstractGraph{T}
    g<span style="color:#f92672">::</span>G
    deleted_vertices<span style="color:#f92672">::</span>V
    VSafeGraph(g<span style="color:#f92672">::</span>G, v<span style="color:#f92672">::</span>V) where {T, G<span style="color:#f92672">&lt;:</span>LG<span style="color:#f92672">.</span>AbstractGraph{T}, V<span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">AbstractVector</span>{<span style="color:#66d9ef">Int</span>}} <span style="color:#f92672">=</span> new{T, G, V}(g, v)
<span style="color:#66d9ef">end</span>

VSafeGraph(g<span style="color:#f92672">::</span>G) where {G<span style="color:#f92672">&lt;:</span>LG<span style="color:#f92672">.</span>AbstractGraph} <span style="color:#f92672">=</span> VSafeGraph(g, <span style="color:#66d9ef">Vector</span>{<span style="color:#66d9ef">Int</span>}())
VSafeGraph(nv<span style="color:#f92672">::</span><span style="color:#66d9ef">Integer</span>) <span style="color:#f92672">=</span> VSafeGraph(LG<span style="color:#f92672">.</span>SimpleGraph(nv))</code></pre></div>
<p>We added simple default constructors for convenience. The structure holds two
elements:</p>
<ul>
<li>An inner abstract graph <code>g</code></li>
<li>A list of vertices already deleted: <code>deleted_vertices</code>.</li>
</ul>
<p>The interface can now be implemented for our type, starting with the trivial
parts:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">LG<span style="color:#f92672">.</span>edges(g<span style="color:#f92672">::</span>VSafeGraph) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>edges(g<span style="color:#f92672">.</span>g)
LG<span style="color:#f92672">.</span>edgetype(g<span style="color:#f92672">::</span>VSafeGraph) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>edgetype(g<span style="color:#f92672">.</span>g)

LG<span style="color:#f92672">.</span>is_directed(g<span style="color:#f92672">::</span>VSafeGraph) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>is_directed(g<span style="color:#f92672">.</span>g)
LG<span style="color:#f92672">.</span>is_directed(<span style="color:#f92672">::</span><span style="color:#66d9ef">Type</span>{<span style="color:#f92672">&lt;:</span>VSafeGraph{T,G}}) where {T,G} <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>is_directed(G)

LG<span style="color:#f92672">.</span>ne(g<span style="color:#f92672">::</span>VSafeGraph) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>ne(g<span style="color:#f92672">.</span>g)
LG<span style="color:#f92672">.</span>nv(g<span style="color:#f92672">::</span>VSafeGraph) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>nv(g<span style="color:#f92672">.</span>g) <span style="color:#f92672">-</span> length(g<span style="color:#f92672">.</span>deleted_vertices)
LG<span style="color:#f92672">.</span>vertices(g<span style="color:#f92672">::</span>VSafeGraph) <span style="color:#f92672">=</span> (v <span style="color:#66d9ef">for</span> v <span style="color:#66d9ef">in</span> LG<span style="color:#f92672">.</span>vertices(g<span style="color:#f92672">.</span>g) <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>(v <span style="color:#66d9ef">in</span> g<span style="color:#f92672">.</span>deleted_vertices))

LG<span style="color:#f92672">.</span>outneighbors(g<span style="color:#f92672">::</span>VSafeGraph, v) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>outneighbors(g<span style="color:#f92672">.</span>g, v)
LG<span style="color:#f92672">.</span>inneighbors(g<span style="color:#f92672">::</span>VSafeGraph, v) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>inneighbors(g<span style="color:#f92672">.</span>g, v)
LG<span style="color:#f92672">.</span>has_vertex(g<span style="color:#f92672">::</span>VSafeGraph, v) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>has_vertex(g<span style="color:#f92672">.</span>g, v) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>(v <span style="color:#66d9ef">in</span> g<span style="color:#f92672">.</span>deleted_vertices)

LG<span style="color:#f92672">.</span>has_edge(g<span style="color:#f92672">::</span>VSafeGraph, e) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>has_edge(g<span style="color:#f92672">.</span>g, e)

LG<span style="color:#f92672">.</span>add_vertex!(g<span style="color:#f92672">::</span>VSafeGraph) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>add_vertex!(g<span style="color:#f92672">.</span>g)

LG<span style="color:#f92672">.</span>rem_edge!(g<span style="color:#f92672">::</span>VSafeGraph, v1, v2) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>rem_edge!(g<span style="color:#f92672">.</span>g, v1, v2)

Base<span style="color:#f92672">.</span>copy(g<span style="color:#f92672">::</span>VSafeGraph) <span style="color:#f92672">=</span> VSafeGraph(copy(g<span style="color:#f92672">.</span>g), copy(g<span style="color:#f92672">.</span>deleteed_vertices))</code></pre></div>
<p>For most of these, we only re-call the method on the inner graph type.
Only for <code>LG.nv</code>, which computes the number of vertices in the inner graph,
minus the number of vertices in our removed list. Now the tricky parts,
adding an edge and removing a vertex, which require a bit more verifications:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">function</span> LG<span style="color:#f92672">.</span>add_edge!(g<span style="color:#f92672">::</span>VSafeGraph, v1, v2)
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>LG<span style="color:#f92672">.</span>has_vertex(g, v1) <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>LG<span style="color:#f92672">.</span>has_vertex(g, v2)
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
    <span style="color:#66d9ef">end</span>
    LG<span style="color:#f92672">.</span>add_edge!(g<span style="color:#f92672">.</span>g, v1, v2)
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">function</span> LG<span style="color:#f92672">.</span>rem_vertex!(g<span style="color:#f92672">::</span>VSafeGraph, v1)
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>LG<span style="color:#f92672">.</span>has_vertex(g, v1) <span style="color:#f92672">||</span> v1 <span style="color:#66d9ef">in</span> g<span style="color:#f92672">.</span>deleted_vertices
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>
    <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">for</span> v2 <span style="color:#66d9ef">in</span> LG<span style="color:#f92672">.</span>outneighbors(g, v1)
        LG<span style="color:#f92672">.</span>rem_edge!(g, v1, v2)
    <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">for</span> v2 <span style="color:#66d9ef">in</span> LG<span style="color:#f92672">.</span>inneighbors(g, v1)
        LG<span style="color:#f92672">.</span>rem_edge!(g, v2, v1)
    <span style="color:#66d9ef">end</span>
    push!(g<span style="color:#f92672">.</span>deleted_vertices, v1)
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
<span style="color:#66d9ef">end</span></code></pre></div>
<p>Instead of removing the vertex <code>v1</code> from the inner graph, the function removes
all edges pointing to and from <code>v1</code>, and then adds it to the removed list.</p>
<h2 id="specific-and-generic-tests">Specific and generic tests</h2>
<p>So far so good, we can add some basic tests to check our type behaves as
expected:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#a6e22e">@testset</span> <span style="color:#e6db74">&#34;Graph construction and basic interface&#34;</span> <span style="color:#66d9ef">begin</span>
    nv <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
    g1 <span style="color:#f92672">=</span> VSafeGraph(nv)
    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(g1) <span style="color:#f92672">==</span> nv
    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(g1<span style="color:#f92672">.</span>g) <span style="color:#f92672">==</span> nv

    g2_inner <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>CompleteGraph(nv)
    g2 <span style="color:#f92672">=</span> VSafeGraph(g2_inner)
    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(g2) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>nv(g2_inner)
    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>ne(g2) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>ne(g2_inner)

    <span style="color:#a6e22e">@test</span> all(sort(collect(LG<span style="color:#f92672">.</span>vertices(g2))) <span style="color:#f92672">.==</span> sort(collect(LG<span style="color:#f92672">.</span>vertices(g2_inner))))

    g3 <span style="color:#f92672">=</span> VSafeGraph(LG<span style="color:#f92672">.</span>CompleteDiGraph(<span style="color:#ae81ff">30</span>))
    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>is_directed(g3)
    <span style="color:#a6e22e">@test</span> <span style="color:#f92672">!</span>LG<span style="color:#f92672">.</span>is_directed(g2)
<span style="color:#66d9ef">end</span>

<span style="color:#a6e22e">@testset</span> <span style="color:#e6db74">&#34;Vertex deletion&#34;</span> <span style="color:#66d9ef">begin</span>
    Random<span style="color:#f92672">.</span>seed!(<span style="color:#ae81ff">33</span>)
    nv <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>
    inner <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>CompleteGraph(nv)
    g <span style="color:#f92672">=</span> VSafeGraph(inner)
    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>ne(inner) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>ne(g)
    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(inner) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>nv(g)
    nrm <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> _ <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">15</span>
        removed_ok <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>rem_vertex!(g, rand(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nv))
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>removed_ok
            <span style="color:#66d9ef">continue</span>
        <span style="color:#66d9ef">end</span>
        nrm <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(inner) <span style="color:#f92672">==</span> nv
        <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(g) <span style="color:#f92672">==</span> nv <span style="color:#f92672">-</span> nrm
        <span style="color:#a6e22e">@test</span> length(g<span style="color:#f92672">.</span>deleted_vertices) <span style="color:#f92672">==</span> nrm

        <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>ne(inner) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>ne(g)
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span></code></pre></div>
<p>So far so good. Now, with the promise of generic graphs and the AbstractGraph
interface, we should be able to use <strong>any</strong> algorithm in <em>LightGraphs.jl</em>,
let us try to compute a page rank and a Kruskal minimum spanning tree:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">nv <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>
inner <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>CompleteGraph(nv)
g <span style="color:#f92672">=</span> VSafeGraph(inner)
removed_ok <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>rem_vertex!(g, rand(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nv))
<span style="color:#a6e22e">@test</span> removed_ok
<span style="color:#75715e"># LG broken here</span>
<span style="color:#a6e22e">@test_throws</span> <span style="color:#66d9ef">BoundsError</span> LG<span style="color:#f92672">.</span>pagerank(g)
<span style="color:#a6e22e">@test_throws</span> <span style="color:#66d9ef">BoundsError</span> LG<span style="color:#f92672">.</span>kruskal_mst(g)</code></pre></div>
<p>Yikes, what&rsquo;s happening here? Many parts of <em>LightGraphs.jl</em> use vertices computed
from <code>vertices(g)</code> as indices for structures indexed by them. So if you remove
vertex 4 in a 6-vertex graph, vertices will be <code>{1,2,3,5,6}</code>, and the rank
algorithm will try to access the 6th rank, even though only 5 exist.</p>
<h2 id="fixes-and-proposal">Fixes and proposal</h2>
<p>It would be too bad to throw the interface altogether, but we need to do
something for the broken behaviour. The underlying assumption here is that
vertices behave like indices for anything vertex-related.
So the way we implement this interface for <code>VSafeGraph</code> is correct, but the
implicit contract is not, the way it is used in algorithms such as pagerank
and Kruskal leak the underlying implementation for <code>SimpleGraph</code>:
a contiguous list of integers from 1 to the number of vertices.
It reminds me of this <a href="https://youtu.be/MdTTt5v-HWQ?t=692">great talk</a>
on paying attention to the contract of an interface in Go, the type is telling
you what to expect in and out, but not how it is supposed or will be used.</p>
<p>The first fix is to make <code>vertices</code> return <code>1:nv(g)</code> for VSafeGraph, but if you
think about it, it means it needs to do such with any graph type, which means
the <code>vertices</code> function is redundant with other functions of the interface and
should not be mandatory. The other option is to fix breaking code to really
use the interface signalled and documented and not the leaked implementation.</p>
<p>We still have some good news though:</p>
<ul>
<li>Changing the code here is strictly non-breaking, since we would just remove
the assumption that vertices are indices.</li>
<li>If we want to keep this assumption for some pieces of code, it means these
pieces are not generic but specialized, something we can handle well using either
dispatch on types or traits, which <em>LightGraphs.jl</em> already does. There is a <code>IsDirected</code>
trait associated with the fact that a graph is directed or not, there could also
be a <code>HasContiguousVertices</code> trait signalling whether this assumption is validated
for a type.</li>
</ul>
<h2 id="edit-refined-proposal">Edit: refined proposal</h2>
<p>Following some discussions with fellow <em>LightGraphs.jl</em> developers and users, a
softer transition could be:</p>
<ol>
<li>Add the functions <code>vertex_indices(g)</code> and <code>vertex_values(g)</code> to the interface, <code>vertex_values</code> could default to <code>vertex_indices</code>, which could itself default on <code>1:nv(g)</code>.</li>
<li>Deprecate <code>vertices(g)</code>, with a fallback to <code>vertex_indices</code>.</li>
<li>Replace all calls to <code>vertex</code> with either <code>vertex_indices</code> or <code>vertex_values</code> depending on which makes sense for the use case.</li>
</ol>
<p>This change is non-breaking and only deprecating <code>vertices</code>, making the
interface more explicit. By keeping the two functions, we avoid having to use
<code>enumerate(vertices_values(g))</code> every time we need indices.</p>
<h2 id="edit-2-corrections-to-the-functions">Edit 2: Corrections to the functions</h2>
<p>I have corrected various functions following Pankaj&rsquo;s much needed
<a href="https://github.com/matbesancon/VertexSafeGraphs.jl/pull/2">Pull Request</a>
on the corresponding repository, thanks!</p>
<h2 id="edit-3">Edit 3</h2>
<p>Seth Bromberger spotted an error in my assumptions,
Swap-and-pop is used for vertex removal, so the last
vertex will take the place of the removed one in the re-labelling.</p>

    </div>

    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/julia/">julia</a>
  
  <a class="badge badge-light" href="/tags/graphs/">graphs</a>
  
  <a class="badge badge-light" href="/tags/interface/">interface</a>
  
</div>



    
      








  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu717a6920346f3d435e65e27c2a66c1ed_48773_250x250_fill_q90_lanczos_center.jpg" itemprop="image" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="https://matbesancon.github.io/">Mathieu Besançon</a></h5>
      <h6 class="card-subtitle">Postdoctoral researcher 22, mathematical optimization</h6>
      <p class="card-text" itemprop="description">Mathematical optimization, scientific programming and related.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="/#contact" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://twitter.com/matbesancon" target="_blank" rel="noopener">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://scholar.google.com/citations?user=-xStCAIAAAAJ" target="_blank" rel="noopener">
              <i class="ai ai-google-scholar"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/matbesancon" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://orcid.org/0000-0002-6284-3033" target="_blank" rel="noopener">
              <i class="ai ai-orcid"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://www.youtube.com/channel/UCVSd42nW_MqkbSXijgOvKwg" target="_blank" rel="noopener">
              <i class="fab fa-youtube"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://linkedin.com/in/mbesancon" target="_blank" rel="noopener">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/post/2018-08-17-abstract_graph/">Building our own graph type in Julia</a></li>
          
          <li><a href="/post/2019-05-08-simple-benders/">A take on Benders decomposition in JuMP</a></li>
          
          <li><a href="/post/2019-04-14-optimization-function-evaluation/">Variables are not values: types and expressions in mathematical optimization</a></li>
          
          <li><a href="/post/2019-04-07-name_distances/">Picking different names with integer optimization</a></li>
          
          <li><a href="/post/2019-03-30-static-list/">Static lists in Julia</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.0.0/mermaid.min.js" integrity="sha256-0w92bcB21IY5+rGI84MGj52jNfHNbXVeQLrZ0CGdjNY=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/julia.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/scala.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/rust.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/go.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/shell.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/dockerfile.min.js"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © 2021 Mathieu Besançon &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
