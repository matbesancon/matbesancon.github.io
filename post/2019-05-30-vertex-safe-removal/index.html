<!DOCTYPE html>
<!-- This site was created with Wowchemy. https://www.wowchemy.com -->
<!-- Last Published: December 23, 2023 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.7.0 for Hugo" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Fira+Mono&family=Fira+Sans&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Mono&family=Fira+Sans&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css" integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.be1e734c86be5b4f1c94d71028ea7cbf.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  


























  
  
  






  <meta name="author" content="Mathieu Besançon" />





  

<meta name="description" content="In various graph-related algorithms, a graph is modified through successive operations, merging, creating and deleting vertices. That&rsquo;s the case for the Blossom algorithm finding a best matching in a graph and using contractions of nodes." />



<link rel="alternate" hreflang="en-us" href="https://matbesancon.xyz/post/2019-05-30-vertex-safe-removal/" />
<link rel="canonical" href="https://matbesancon.xyz/post/2019-05-30-vertex-safe-removal/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  
  






<meta property="twitter:card" content="summary" />

  <meta property="twitter:site" content="@matbesancon" />
  <meta property="twitter:creator" content="@matbesancon" />
<meta property="twitter:image" content="https://matbesancon.xyz/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_512x512_fill_lanczos_center_3.png" />
<meta property="og:site_name" content="μβ" />
<meta property="og:url" content="https://matbesancon.xyz/post/2019-05-30-vertex-safe-removal/" />
<meta property="og:title" content="Vertex removal in LightGraphs | μβ" />
<meta property="og:description" content="In various graph-related algorithms, a graph is modified through successive operations, merging, creating and deleting vertices. That&rsquo;s the case for the Blossom algorithm finding a best matching in a graph and using contractions of nodes." /><meta property="og:image" content="https://matbesancon.xyz/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2019-05-30T11:14:43&#43;02:00"
    />
  
  
    <meta property="article:modified_time" content="2020-01-06T16:40:51&#43;01:00">
  






    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://matbesancon.xyz/post/2019-05-30-vertex-safe-removal/"
  },
  "headline": "Vertex removal in LightGraphs",
  
  "datePublished": "2019-05-30T11:14:43+02:00",
  "dateModified": "2020-01-06T16:40:51+01:00",
  
  "author": {
    "@type": "Person",
    "name": "Mathieu Besançon"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "μβ",
    "logo": {
      "@type": "ImageObject",
      "url": "https://matbesancon.xyz/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "In various graph-related algorithms, a graph is modified through successive operations, merging, creating and deleting vertices. That\u0026rsquo;s the case for the Blossom algorithm finding a best matching in a graph and using contractions of nodes."
}
</script>

  

  




  
  
  

  
  

  


  
  <title>Vertex removal in LightGraphs | μβ</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="732b9b8a8f3f03fb4cee321f67ba5ca4" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">μβ</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">μβ</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#experience"><span>Experience</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#publications"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#posts"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#workwithme"><span>Work with me</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#contact"><span>Contact</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  













  

  
  
  
<div class="article-container pt-3">
  <h1>Vertex removal in LightGraphs</h1>

  
  <p class="page-subtitle">Testing abstractions, their limits and leaks</p>
  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    2020-01-06
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    6 min read
  </span>
  

  
  
  
  

  
  

</div>

    





  
</div>



  <div class="article-container">

    <div class="article-style">
      <p>In various graph-related algorithms, a graph is modified through successive
operations, merging, creating and deleting vertices. That&rsquo;s the case for the
<a href="https://en.wikipedia.org/wiki/Blossom_algorithm" target="_blank" rel="noopener">Blossom algorithm</a> finding a
best matching in a graph and using contractions of nodes.
In such cases, it can be useful to remove only the vertex being contracted,
and maintain the number of all other vertices.</p>
<p><em>LightGraphs.jl</em> offers a set of abstractions, types and algorithms to get started
with graphs. The claim of the abstraction is simple: whatever the underlying
structure representing your graph, if it implements the <code>AbstractGraph</code> interface,
it can be used out of the box with all algorithms built on <em>LightGraphs.jl</em>.
The main concrete type presented by <em>LightGraphs.jl</em> is <code>SimpleGraph</code> and its
directed counterpart <code>SimpleDiGraph</code>, only storing edges as adjacency lists,
meaning vertices are just the integers from 1 to the length of the list.
This means that in a graph with 6 vertices, deleting vertex 4 will re-label vertex 6
as 4. Hopefully, the interface should allow us to build a graph type on top of another graph,
re-implementing only vertex removal.</p>
<h2 id="a-simple-vertex-safe-implementation">A simple vertex-safe implementation</h2>
<p>First things first, we will build it as a struct, using LightGraphs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> LightGraphs
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> LG <span style="color:#f92672">=</span> LightGraphs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#66d9ef">VSafeGraph</span>{<span style="color:#66d9ef">T</span>, <span style="color:#66d9ef">G</span><span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">LG</span><span style="color:#f92672">.</span><span style="color:#66d9ef">AbstractGraph</span>{<span style="color:#66d9ef">T</span>}, <span style="color:#66d9ef">V</span><span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">AbstractVector</span>{<span style="color:#66d9ef">Int</span>}} <span style="color:#f92672">&lt;:</span> <span style="color:#66d9ef">LG</span><span style="color:#f92672">.</span><span style="color:#66d9ef">AbstractGraph</span>{<span style="color:#66d9ef">T</span>}
</span></span><span style="display:flex;"><span>    g<span style="color:#f92672">::</span><span style="color:#66d9ef">G</span>
</span></span><span style="display:flex;"><span>    deleted_vertices<span style="color:#f92672">::</span><span style="color:#66d9ef">V</span>
</span></span><span style="display:flex;"><span>    VSafeGraph(g<span style="color:#f92672">::</span><span style="color:#66d9ef">G</span>, v<span style="color:#f92672">::</span><span style="color:#66d9ef">V</span>) <span style="color:#66d9ef">where</span> {<span style="color:#66d9ef">T</span>, <span style="color:#66d9ef">G</span><span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">LG</span><span style="color:#f92672">.</span><span style="color:#66d9ef">AbstractGraph</span>{<span style="color:#66d9ef">T</span>}, <span style="color:#66d9ef">V</span><span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">AbstractVector</span>{<span style="color:#66d9ef">Int</span>}} <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span>{<span style="color:#66d9ef">T</span>, <span style="color:#66d9ef">G</span>, <span style="color:#66d9ef">V</span>}(g, v)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>VSafeGraph(g<span style="color:#f92672">::</span><span style="color:#66d9ef">G</span>) <span style="color:#66d9ef">where</span> {<span style="color:#66d9ef">G</span><span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">LG</span><span style="color:#f92672">.</span><span style="color:#66d9ef">AbstractGraph</span>} <span style="color:#f92672">=</span> VSafeGraph(g, <span style="color:#66d9ef">Vector</span>{<span style="color:#66d9ef">Int</span>}())
</span></span><span style="display:flex;"><span>VSafeGraph(nv<span style="color:#f92672">::</span><span style="color:#66d9ef">Integer</span>) <span style="color:#f92672">=</span> VSafeGraph(LG<span style="color:#f92672">.</span>SimpleGraph(nv))</span></span></code></pre></div>
<p>We added simple default constructors for convenience. The structure holds two
elements:</p>
<ul>
<li>An inner abstract graph <code>g</code></li>
<li>A list of vertices already deleted: <code>deleted_vertices</code>.</li>
</ul>
<p>The interface can now be implemented for our type, starting with the trivial
parts:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>edges(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>edges(g<span style="color:#f92672">.</span>g)
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>edgetype(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>edgetype(g<span style="color:#f92672">.</span>g)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>is_directed(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>is_directed(g<span style="color:#f92672">.</span>g)
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>is_directed(<span style="color:#f92672">::</span><span style="color:#66d9ef">Type</span>{<span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">VSafeGraph</span>{<span style="color:#66d9ef">T</span>,<span style="color:#66d9ef">G</span>}}) <span style="color:#66d9ef">where</span> {<span style="color:#66d9ef">T</span>,<span style="color:#66d9ef">G</span>} <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>is_directed(G)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>ne(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>ne(g<span style="color:#f92672">.</span>g)
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>nv(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>nv(g<span style="color:#f92672">.</span>g) <span style="color:#f92672">-</span> length(g<span style="color:#f92672">.</span>deleted_vertices)
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>vertices(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>) <span style="color:#f92672">=</span> (v <span style="color:#66d9ef">for</span> v <span style="color:#66d9ef">in</span> LG<span style="color:#f92672">.</span>vertices(g<span style="color:#f92672">.</span>g) <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>(v <span style="color:#66d9ef">in</span> g<span style="color:#f92672">.</span>deleted_vertices))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>outneighbors(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>, v) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>outneighbors(g<span style="color:#f92672">.</span>g, v)
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>inneighbors(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>, v) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>inneighbors(g<span style="color:#f92672">.</span>g, v)
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>has_vertex(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>, v) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>has_vertex(g<span style="color:#f92672">.</span>g, v) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>(v <span style="color:#66d9ef">in</span> g<span style="color:#f92672">.</span>deleted_vertices)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>has_edge(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>, e) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>has_edge(g<span style="color:#f92672">.</span>g, e)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>add_vertex!(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>add_vertex!(g<span style="color:#f92672">.</span>g)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LG<span style="color:#f92672">.</span>rem_edge!(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>, v1, v2) <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>rem_edge!(g<span style="color:#f92672">.</span>g, v1, v2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Base<span style="color:#f92672">.</span>copy(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>) <span style="color:#f92672">=</span> VSafeGraph(copy(g<span style="color:#f92672">.</span>g), copy(g<span style="color:#f92672">.</span>deleteed_vertices))</span></span></code></pre></div>
<p>For most of these, we only re-call the method on the inner graph type.
Only for <code>LG.nv</code>, which computes the number of vertices in the inner graph,
minus the number of vertices in our removed list. Now the tricky parts,
adding an edge and removing a vertex, which require a bit more verifications:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> LG<span style="color:#f92672">.</span>add_edge!(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>, v1, v2)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>LG<span style="color:#f92672">.</span>has_vertex(g, v1) <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>LG<span style="color:#f92672">.</span>has_vertex(g, v2)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> false
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    LG<span style="color:#f92672">.</span>add_edge!(g<span style="color:#f92672">.</span>g, v1, v2)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> LG<span style="color:#f92672">.</span>rem_vertex!(g<span style="color:#f92672">::</span><span style="color:#66d9ef">VSafeGraph</span>, v1)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>LG<span style="color:#f92672">.</span>has_vertex(g, v1) <span style="color:#f92672">||</span> v1 <span style="color:#66d9ef">in</span> g<span style="color:#f92672">.</span>deleted_vertices
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> false
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> v2 <span style="color:#66d9ef">in</span> LG<span style="color:#f92672">.</span>outneighbors(g, v1)
</span></span><span style="display:flex;"><span>        LG<span style="color:#f92672">.</span>rem_edge!(g, v1, v2)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> v2 <span style="color:#66d9ef">in</span> LG<span style="color:#f92672">.</span>inneighbors(g, v1)
</span></span><span style="display:flex;"><span>        LG<span style="color:#f92672">.</span>rem_edge!(g, v2, v1)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    push!(g<span style="color:#f92672">.</span>deleted_vertices, v1)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> true
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span></span></span></code></pre></div>
<p>Instead of removing the vertex <code>v1</code> from the inner graph, the function removes
all edges pointing to and from <code>v1</code>, and then adds it to the removed list.</p>
<h2 id="specific-and-generic-tests">Specific and generic tests</h2>
<p>So far so good, we can add some basic tests to check our type behaves as
expected:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#a6e22e">@testset</span> <span style="color:#e6db74">&#34;Graph construction and basic interface&#34;</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>    nv <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>    g1 <span style="color:#f92672">=</span> VSafeGraph(nv)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(g1) <span style="color:#f92672">==</span> nv
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(g1<span style="color:#f92672">.</span>g) <span style="color:#f92672">==</span> nv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    g2_inner <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>CompleteGraph(nv)
</span></span><span style="display:flex;"><span>    g2 <span style="color:#f92672">=</span> VSafeGraph(g2_inner)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(g2) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>nv(g2_inner)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>ne(g2) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>ne(g2_inner)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@test</span> all(sort(collect(LG<span style="color:#f92672">.</span>vertices(g2))) <span style="color:#f92672">.==</span> sort(collect(LG<span style="color:#f92672">.</span>vertices(g2_inner))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    g3 <span style="color:#f92672">=</span> VSafeGraph(LG<span style="color:#f92672">.</span>CompleteDiGraph(<span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>is_directed(g3)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@test</span> <span style="color:#f92672">!</span>LG<span style="color:#f92672">.</span>is_directed(g2)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@testset</span> <span style="color:#e6db74">&#34;Vertex deletion&#34;</span> <span style="color:#66d9ef">begin</span>
</span></span><span style="display:flex;"><span>    Random<span style="color:#f92672">.</span>seed!(<span style="color:#ae81ff">33</span>)
</span></span><span style="display:flex;"><span>    nv <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>
</span></span><span style="display:flex;"><span>    inner <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>CompleteGraph(nv)
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> VSafeGraph(inner)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>ne(inner) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>ne(g)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(inner) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>nv(g)
</span></span><span style="display:flex;"><span>    nrm <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>        removed_ok <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>rem_vertex!(g, rand(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nv))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span>removed_ok
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>        nrm <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(inner) <span style="color:#f92672">==</span> nv
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>nv(g) <span style="color:#f92672">==</span> nv <span style="color:#f92672">-</span> nrm
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@test</span> length(g<span style="color:#f92672">.</span>deleted_vertices) <span style="color:#f92672">==</span> nrm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">@test</span> LG<span style="color:#f92672">.</span>ne(inner) <span style="color:#f92672">==</span> LG<span style="color:#f92672">.</span>ne(g)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span></span></span></code></pre></div>
<p>So far so good. Now, with the promise of generic graphs and the AbstractGraph
interface, we should be able to use <strong>any</strong> algorithm in <em>LightGraphs.jl</em>,
let us try to compute a page rank and a Kruskal minimum spanning tree:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>nv <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>
</span></span><span style="display:flex;"><span>inner <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>CompleteGraph(nv)
</span></span><span style="display:flex;"><span>g <span style="color:#f92672">=</span> VSafeGraph(inner)
</span></span><span style="display:flex;"><span>removed_ok <span style="color:#f92672">=</span> LG<span style="color:#f92672">.</span>rem_vertex!(g, rand(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>nv))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@test</span> removed_ok
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LG broken here</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@test_throws</span> <span style="color:#66d9ef">BoundsError</span> LG<span style="color:#f92672">.</span>pagerank(g)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@test_throws</span> <span style="color:#66d9ef">BoundsError</span> LG<span style="color:#f92672">.</span>kruskal_mst(g)</span></span></code></pre></div>
<p>Yikes, what&rsquo;s happening here? Many parts of <em>LightGraphs.jl</em> use vertices computed
from <code>vertices(g)</code> as indices for structures indexed by them. So if you remove
vertex 4 in a 6-vertex graph, vertices will be <code>{1,2,3,5,6}</code>, and the rank
algorithm will try to access the 6th rank, even though only 5 exist.</p>
<h2 id="fixes-and-proposal">Fixes and proposal</h2>
<p>It would be too bad to throw the interface altogether, but we need to do
something for the broken behaviour. The underlying assumption here is that
vertices behave like indices for anything vertex-related.
So the way we implement this interface for <code>VSafeGraph</code> is correct, but the
implicit contract is not, the way it is used in algorithms such as pagerank
and Kruskal leak the underlying implementation for <code>SimpleGraph</code>:
a contiguous list of integers from 1 to the number of vertices.
It reminds me of this <a href="https://youtu.be/MdTTt5v-HWQ?t=692" target="_blank" rel="noopener">great talk</a>
on paying attention to the contract of an interface in Go, the type is telling
you what to expect in and out, but not how it is supposed or will be used.</p>
<p>The first fix is to make <code>vertices</code> return <code>1:nv(g)</code> for VSafeGraph, but if you
think about it, it means it needs to do such with any graph type, which means
the <code>vertices</code> function is redundant with other functions of the interface and
should not be mandatory. The other option is to fix breaking code to really
use the interface signalled and documented and not the leaked implementation.</p>
<p>We still have some good news though:</p>
<ul>
<li>Changing the code here is strictly non-breaking, since we would just remove
the assumption that vertices are indices.</li>
<li>If we want to keep this assumption for some pieces of code, it means these
pieces are not generic but specialized, something we can handle well using either
dispatch on types or traits, which <em>LightGraphs.jl</em> already does. There is a <code>IsDirected</code>
trait associated with the fact that a graph is directed or not, there could also
be a <code>HasContiguousVertices</code> trait signalling whether this assumption is validated
for a type.</li>
</ul>
<h2 id="edit-refined-proposal">Edit: refined proposal</h2>
<p>Following some discussions with fellow <em>LightGraphs.jl</em> developers and users, a
softer transition could be:</p>
<ol>
<li>Add the functions <code>vertex_indices(g)</code> and <code>vertex_values(g)</code> to the interface, <code>vertex_values</code> could default to <code>vertex_indices</code>, which could itself default on <code>1:nv(g)</code>.</li>
<li>Deprecate <code>vertices(g)</code>, with a fallback to <code>vertex_indices</code>.</li>
<li>Replace all calls to <code>vertex</code> with either <code>vertex_indices</code> or <code>vertex_values</code> depending on which makes sense for the use case.</li>
</ol>
<p>This change is non-breaking and only deprecating <code>vertices</code>, making the
interface more explicit. By keeping the two functions, we avoid having to use
<code>enumerate(vertices_values(g))</code> every time we need indices.</p>
<h2 id="edit-2-corrections-to-the-functions">Edit 2: Corrections to the functions</h2>
<p>I have corrected various functions following Pankaj&rsquo;s much needed
<a href="https://github.com/matbesancon/VertexSafeGraphs.jl/pull/2" target="_blank" rel="noopener">Pull Request</a>
on the corresponding repository, thanks!</p>
<h2 id="edit-3">Edit 3</h2>
<p>Seth Bromberger spotted an error in my assumptions,
Swap-and-pop is used for vertex removal, so the last
vertex will take the place of the removed one in the re-labelling.</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/julia/">julia</a>
  
  <a class="badge badge-light" href="/tag/graphs/">graphs</a>
  
  <a class="badge badge-light" href="/tag/interface/">interface</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2019-05-30-vertex-safe-removal%2F&amp;text=Vertex&#43;removal&#43;in&#43;LightGraphs" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2019-05-30-vertex-safe-removal%2F&amp;t=Vertex&#43;removal&#43;in&#43;LightGraphs" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=Vertex%20removal%20in%20LightGraphs&amp;body=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2019-05-30-vertex-safe-removal%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2019-05-30-vertex-safe-removal%2F&amp;title=Vertex&#43;removal&#43;in&#43;LightGraphs" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=Vertex&#43;removal&#43;in&#43;LightGraphs%20https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2019-05-30-vertex-safe-removal%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2019-05-30-vertex-safe-removal%2F&amp;title=Vertex&#43;removal&#43;in&#43;LightGraphs" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://matbesancon.xyz/"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu717a6920346f3d435e65e27c2a66c1ed_48773_270x270_fill_q75_lanczos_center.jpg" alt="Mathieu Besançon"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://matbesancon.xyz/">Mathieu Besançon</a></h5>
      <h6 class="card-subtitle">Researcher in mathematical optimization</h6>
      <p class="card-text">Mathematical optimization, scientific programming and related.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/matbesancon" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=-xStCAIAAAAJ" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/matbesancon" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://orcid.org/0000-0002-6284-3033" target="_blank" rel="noopener">
        <i class="ai ai-orcid"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.youtube.com/channel/UCVSd42nW_MqkbSXijgOvKwg" target="_blank" rel="noopener">
        <i class="fab fa-youtube"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://linkedin.com/in/mbesancon" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    © 2023 Mathieu Besançon.
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-sa/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-sa fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>




    <p class="powered-by">
    Published with Hugo and Wowchemy.
   </p>


</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js"></script>




  

  
  

  













  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":true}</script>



  <script src="/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.2945731fa88332cb0ec33cf47d29879f.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>


















</body>
</html>
