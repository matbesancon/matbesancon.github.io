<!DOCTYPE html>
<html lang="en-ca">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Mathieu Besançon">

  
  
  
    
  
  <meta name="description" content="Leveraging one of Julia central features for clearer formulation of an optimization problem.
">

  
  <link rel="alternate" hreflang="en-ca" href="https://matbesancon.github.io/post/2019-02-24-multiple-dispatch-optimizers/">

  


  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/monokai.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/monokai.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.11bfb5db527d0300a83b31a367badc35.css">

  

  
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://matbesancon.github.io/post/2019-02-24-multiple-dispatch-optimizers/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@matbesancon">
  <meta property="twitter:creator" content="@matbesancon">
  
  <meta property="og:site_name" content="μβ">
  <meta property="og:url" content="https://matbesancon.github.io/post/2019-02-24-multiple-dispatch-optimizers/">
  <meta property="og:title" content="Multiple dispatch - an example for mathematical optimizers | μβ">
  <meta property="og:description" content="Leveraging one of Julia central features for clearer formulation of an optimization problem.
"><meta property="og:image" content="https://matbesancon.github.io/img/icon-192.png">
  <meta property="twitter:image" content="https://matbesancon.github.io/img/icon-192.png"><meta property="og:locale" content="en-ca">
  
  <meta property="article:published_time" content="2019-02-24T00:00:00&#43;01:00">
  
  <meta property="article:modified_time" content="2019-03-01T19:22:25&#43;01:00">
  

  


  





  <title>Multiple dispatch - an example for mathematical optimizers | μβ</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">μβ</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>Projects</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Multiple dispatch - an example for mathematical optimizers</h1>

  

  
    



<meta content="2019-02-24 00:00:00 &#43;0100 CET" itemprop="datePublished">
<meta content="2019-03-01 19:22:25 &#43;0100 CET" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    <time>2019-03-01</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    8 min read
  </span>
  

  
  

  
  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://matbesancon.github.io/post/2019-02-24-multiple-dispatch-optimizers/&amp;text=Multiple%20dispatch%20-%20an%20example%20for%20mathematical%20optimizers" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://matbesancon.github.io/post/2019-02-24-multiple-dispatch-optimizers/&amp;t=Multiple%20dispatch%20-%20an%20example%20for%20mathematical%20optimizers" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Multiple%20dispatch%20-%20an%20example%20for%20mathematical%20optimizers&amp;body=https://matbesancon.github.io/post/2019-02-24-multiple-dispatch-optimizers/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://matbesancon.github.io/post/2019-02-24-multiple-dispatch-optimizers/&amp;title=Multiple%20dispatch%20-%20an%20example%20for%20mathematical%20optimizers" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Multiple%20dispatch%20-%20an%20example%20for%20mathematical%20optimizers%20https://matbesancon.github.io/post/2019-02-24-multiple-dispatch-optimizers/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://matbesancon.github.io/post/2019-02-24-multiple-dispatch-optimizers/&amp;title=Multiple%20dispatch%20-%20an%20example%20for%20mathematical%20optimizers" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>


  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      <p>In a recent pull request on a personal project, I spent some time designing
an intuitive API for a specific problem. After reaching a satisfying result,
I realized this would never have been possible without one of the central
mechanisms of the Julia language: <strong>multiple dispatch</strong>. Feel free to read the
<a href="https://docs.julialang.org/en/v1/manual/methods/">Julia docs</a> on the topic
or what <a href="https://en.wikipedia.org/wiki/Multiple_dispatch">Wikipedia</a> has to say
about it.</p>
<p>This post is a walkthrough for multiple dispatch for a case in mathematical
optimization. The first part will introduce the problem context and requires
some notion in mathematical optimization, if this stuff is scary, feel free to
skip to the rest directly.</p>
<!-- raw HTML omitted -->
<h1 id="refresher-on-if-then-else-constraints">Refresher on if-then-else constraints</h1>
<p>I promised an example oriented towards mathematical optimization, here it is:
it is common to model constraints with two variables $(x, y)$,
$x$ continuous and $y$ binary stating:</p>
<ul>
<li>$y = 0 \Rightarrow x = 0$</li>
<li>If $y = 1$, there is no specific constraint on $x$</li>
</ul>
<p>Some examples of models with such constraint:</p>
<ul>
<li><strong>Facility location</strong>: if a wharehouse is not opened, $y = 0$, then the quantity
served by this point has to be $x = 0$, otherwise, the quantity can go up to
the wharehouse capacity.</li>
<li><strong>Unit commitment</strong> (a classic problem for power systems): if a power plant
has not been activated for a given hour, then it cannot supply any power,
otherwise, it can supply up to its capacity.</li>
<li><strong>Complementarity constraints</strong>: if a dual variable $\lambda$ is 0,
then the corresponding constraint is not active (in non-degenerate cases,
the slack variable is non-zero)</li>
</ul>
<p>Logical constraints with such if-then-else structure cannot be handled by
established optimization solvers, at least not in an efficient way. There are
two usual ways to implement this, &ldquo;big-M&rdquo; type constraints and special-ordered
sets of type 1 <code>SOS1</code>.</p>
<p>A SOS1 constraint specifies that out of a set of variables or expressions,
at most one of them can be non-zero. In our case, the if-then-else constraint
can be modeled as:
$$SOS1(x,, 1-y)$$</p>
<p>Most solvers handling integer variables can use these $SOS1$ constraints
within a branch-and-bound procedure.</p>
<p>The other formulation is using an upper-bound on the $x$ variable, usually
written $M$, hence the name:</p>
<p>$$x \leq M \cdot y $$</p>
<p>If $y=0$, $x$ can be at most 0, otherwise it is bounded by $M$. If $M$
is sufficiently big, the constraint becomes inactive.
However, smaller $M$ values yield tighter formulations, solved more efficiently.
See <a href="https://orinanobworld.blogspot.com/2018/09/choosing-big-m-values.html">Paul Rubin&rsquo;s</a>
detailed blog post on the subject. If we want bounds as tight as possible, it
is always preferable to choose one bound per constraint, instead of one unique
$M$ for them all, which means we need a majorant of all individual $M$.</p>
<p>As a rule of thumb, big-M constraints are pretty efficient if $M$ is tight,
but if we have no idea about it, SOS1 constraints may be more interesting,
see [1] for recent numerical experiments applied to bilevel problems.</p>
<h1 id="modeling-if-then-else-constraints">Modeling if-then-else constraints</h1>
<p>Now that the context is set, our task is to model if-then-else constraints
in the best possible way, in a modeling package for instance. We want the user
to specify something as:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, method, params)
    <span style="color:#75715e"># build the constraint with method using params</span>
<span style="color:#66d9ef">end</span></code></pre></div>
<p>Without a dispatch feature baked within the language, we will end up doing
it ourselves, for instance in:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, method, params)
    <span style="color:#66d9ef">if</span> typeof(method) <span style="color:#f92672">==</span> SOS1Method
        <span style="color:#75715e"># model as SOS1Method</span>
    <span style="color:#66d9ef">elseif</span> typeof(method) <span style="color:#f92672">==</span> BigMMethod
        <span style="color:#75715e"># handle as big M with params</span>
    <span style="color:#66d9ef">else</span>
        throw(<span style="color:#66d9ef">MethodError</span>(<span style="color:#e6db74">&#34;Method unknown&#34;</span>))
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span></code></pre></div>
<p>NB: if you have to do that in Julia, there is a <code>isa(x, T)</code> function
verifying if <code>x</code> is a <code>T</code> in a more concise way, this is verifying sub-typing
instead of type equality, which is much more flexible.</p>
<p>The function is way longer than necessary, and will have to be modified every
time. In a more idiomatic way, what we can do is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">struct</span> SOS1Method <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">struct</span> BigMMethod <span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, <span style="color:#f92672">::</span>SOS1Method)
    <span style="color:#75715e"># model as SOS1Method</span>
<span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, <span style="color:#f92672">::</span>BigMMethod, params)
    <span style="color:#75715e"># handle as big M with params</span>
<span style="color:#66d9ef">end</span></code></pre></div>
<p>Much better here, three things to notice:</p>
<ul>
<li>This may look similar to pattern matching in function arguments if you are
familiar with languages as Elixir. However, the method to use can be determined
using static dispatch, i.e. at compile-time.</li>
<li>We don&rsquo;t need to carry around <code>params</code> in the case of the SOS1 method,
since we don&rsquo;t use them, so we can adapt the method signature to pass only
what is needed.</li>
<li>This code is much easier to document, each method can be documented on
its own type, and the reader can refer to the method directly.</li>
</ul>
<p>Cherry on top, any user can define their own technique by importing our function
and defining a new behavior:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">import</span> OtherPackage <span style="color:#75715e"># where the function is defined</span>

<span style="color:#66d9ef">struct</span> MyNewMethod <span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, <span style="color:#f92672">::</span>MyNewMethod)
    <span style="color:#75715e"># define a new method for ifthenelse, much more efficient</span>
<span style="color:#66d9ef">end</span></code></pre></div></p>
<h1 id="handling-big-m-in-an-elegant-way">Handling big M in an elegant way</h1>
<p>We have seen how to dispatch on the technique, but still we are missing one
point: handling the <code>params</code> in big-M formulations. If you have pairs of $(x_j,y_j)$,
then users may want:</p>
<p>$$ x_j \leq M_j \cdot y_j,, \forall j $$</p>
<p>Or:
$$ x_j \leq M \cdot y_j,, \forall j $$</p>
<p>The first formulation requires a vector of M values, and the second one
requires a scalar. One default option would be to adapt to the most general one:
if several M values are given, build a vector, if there is only one, repeat it
for each $j$. One way to do it using dynamic typing:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">struct</span> BigMMethod <span style="color:#66d9ef">end</span>

<span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, <span style="color:#f92672">::</span>BigMMethod, M<span style="color:#f92672">::</span><span style="color:#66d9ef">Union</span>{<span style="color:#66d9ef">Real</span>,<span style="color:#66d9ef">AbstractVector</span>{<span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">Real</span>}})
    <span style="color:#66d9ef">if</span> M <span style="color:#66d9ef">isa</span> <span style="color:#66d9ef">Real</span>
        <span style="color:#75715e"># handle with one unique M</span>
    <span style="color:#66d9ef">else</span>
        <span style="color:#75715e"># it is a vector</span>
        <span style="color:#75715e"># handle with each M[j]</span>
    <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span></code></pre></div></p>
<p>Note that we can constrain the type of M to be either a scalar or a Vector
using <code>Union</code> type. Still, this type verification can be done using dispatch,
and we can handle the multiple cases:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">struct</span> BigMMethod <span style="color:#66d9ef">end</span>

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Use one unique big M value
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, <span style="color:#f92672">::</span>BigMMethod, M<span style="color:#f92672">::</span><span style="color:#66d9ef">Real</span>)
    <span style="color:#75715e"># handle with one unique M</span>
<span style="color:#66d9ef">end</span>

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Use a vector of big M value
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, <span style="color:#f92672">::</span>BigMMethod, Mvec<span style="color:#f92672">::</span><span style="color:#66d9ef">AbstractVector</span>)
    <span style="color:#75715e"># handle with each Mvec[j]</span>
<span style="color:#66d9ef">end</span></code></pre></div>
<p>This solution is fine, and resolving most things at compile-time.
Also, note that we are defining one signature as a convenience way redirecting
to another.</p>
<h1 id="polishing-our-design-enriched-types">Polishing our design: enriched types</h1>
<p>The last solution is great, we are dispatching on our algorithm and parameter
types. However, in a realistic research or development work, many more
decisions are taken such as algorithms options, number types, various parameters.
We will likely end up with something similar to:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">function</span> do_science(x, y, z,
                    <span style="color:#f92672">::</span>Alg1, params_alg_1,
                    <span style="color:#f92672">::</span>Alg2, params_alg_2,
                    <span style="color:#f92672">::</span>Alg3, <span style="color:#75715e"># algortithm 3 does not need parameters</span>
                    <span style="color:#f92672">::</span>Alg4, params_alg_4)
    <span style="color:#75715e"># do something with params_alg_1 for Alg1</span>
    <span style="color:#75715e"># do something with params_alg_2 for Alg2</span>
    <span style="color:#75715e"># ...</span>
<span style="color:#66d9ef">end</span></code></pre></div>
<p>Requiring users to pass all arguments and types in the correct order.
A long chain of positional arguments like this end makes for error-prone
and cumbersome interfaces. Can we change this? We created all our types as
empty structures <code>struct A end</code> and use it just to dispatch. Instead,
we could store adapted parameters within the corresponding type:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">struct</span> Alg1
    coefficient<span style="color:#f92672">::</span><span style="color:#66d9ef">Float64</span>
    direction<span style="color:#f92672">::</span><span style="color:#66d9ef">Vector</span>{<span style="color:#66d9ef">Float64</span>}
<span style="color:#66d9ef">end</span>

<span style="color:#75715e"># define other types</span>

<span style="color:#66d9ef">function</span> do_science(x, y, z, a1<span style="color:#f92672">::</span>Alg1, a2<span style="color:#f92672">::</span>Alg2, <span style="color:#f92672">::</span>Alg3, a4<span style="color:#f92672">::</span>Alg4)
    <span style="color:#75715e"># do something with params_alg_1 for Alg1</span>
    <span style="color:#75715e"># a1.coefficient, a1.direction...</span>
    <span style="color:#75715e"># do something with Alg2</span>
    <span style="color:#75715e"># ...</span>
<span style="color:#66d9ef">end</span></code></pre></div>
<p>Getting back to our initial use case of <code>BigMMethod</code>, we need to store
the $M$ value(s) in the structure:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">struct</span> BigMMethod
    M<span style="color:#f92672">::</span><span style="color:#66d9ef">Union</span>{<span style="color:#66d9ef">Float64</span>, <span style="color:#66d9ef">Vector</span>{<span style="color:#66d9ef">Float64</span>}}
<span style="color:#66d9ef">end</span></code></pre></div></p>
<p>This seems fine, however, the Julia compiler cannot know the type of the <code>M</code>
field at compile-time, instead, we can use a type parameter here:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#66d9ef">struct</span> BigMMethod{MT<span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">Union</span>{<span style="color:#66d9ef">Real</span>, <span style="color:#66d9ef">AbstractVector</span>{<span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">Real</span>}}}
    M<span style="color:#f92672">::</span>MT
    BigMMethod(M<span style="color:#f92672">::</span>MT) where {MT} <span style="color:#f92672">=</span> new{MT}(M)
<span style="color:#66d9ef">end</span></code></pre></div></p>
<p>When constructing the BigMMethod with this definition, it can be specialized
on <code>MT</code>, the type of <code>M</code>, two examples of valid definitions are:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">BigMMethod(<span style="color:#ae81ff">3.0</span>)
<span style="color:#75715e"># result: BigMMethod{Float64}(3.0)</span>

BigMMethod(<span style="color:#ae81ff">3</span>)
<span style="color:#75715e"># result: BigMMethod{Int}(3)</span>

BigMMethod([<span style="color:#ae81ff">3.0</span>, <span style="color:#ae81ff">5.0</span>])
<span style="color:#75715e"># result BigMMethod{Vector{Float64}}([3.0, 5.0])</span></code></pre></div></p>
<p>The advantage is we can now specialize the <code>handle_ifthenelse</code>
signature on the type parameter of M, as below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Use one unique big M value
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, bm<span style="color:#f92672">::</span>BigMMethod{<span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">Real</span>})
    <span style="color:#75715e"># handle with one unique M bm.M</span>
<span style="color:#66d9ef">end</span>

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Use a vector of big M value
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#66d9ef">function</span> handle_ifthenelse(x, y, bm<span style="color:#f92672">::</span>BigMMethod{<span style="color:#f92672">&lt;:</span><span style="color:#66d9ef">AbstractVector</span>})
    <span style="color:#75715e"># handle with each bm.M[j]</span>
<span style="color:#66d9ef">end</span></code></pre></div>
<p>The advantage is a strictly identical signature, whatever the method and
its parameters, users will always call it with:
<code>handle_ifthenelse(x, y, bm::BigMMethod{&lt;:AbstractVector})</code></p>
<h1 id="conclusion-avoiding-a-clarity-flexibility-trade-off">Conclusion: avoiding a clarity-flexibility trade-off</h1>
<p>In this simple but commonly encountered example, we leveraged multiple dispatch,
the ability to choose a function implementation depending on the type of its
arguments. This helped us define a homogeneous interface for specifying a type
of constraint, specializing on the method (SOS1 or big M) and on the data
available (one M or a vector of M values).</p>
<p>Performance bonus, this design is providing the Julia compiler with strong type
information while remaining flexible for the user. In Julia terminology,
this property is called <a href="https://docs.julialang.org/en/v1/manual/performance-tips/#Avoid-changing-the-type-of-a-variable-1">type stability</a>.
We would not have benefitted from this property if we had used reflection-based
design (with <code>typeof()</code> and <code>isa</code>).</p>
<p>This idea of using big-M as an example did not come up in the abstract but is
a simplification of the design used in the
<a href="https://github.com/matbesancon/BilevelOptimization.jl">BilevelOptimization.jl</a>
package. Remember I mentioned complementarity constraints, it is exactly this
use case.</p>
<p>If you are interested in more examples of multiple dispatch and hands-on
use cases for the Julia type system, check out
<a href="https://blog.moelf.xyz/real-world-example-for-julia-typing/">these</a>
<a href="https://white.ucc.asn.au/2018/10/03/Dispatch,-Traits-and-Metaprogramming-Over-Reflection.html">two</a>
articles.
Feel free to reach out any way you prefer, <a href="https://twitter.com/matbesancon">Twitter</a>,
<a href="/#contact">email</a>.</p>
<hr>
<p>Edit 1: thanks BYP for sharp proofreading and constructive critics.</p>
<p>Edit 2: Thanks Mathieu Tanneau for pointing out the alternative solution of
indicator constraints instead of big M, as documented in <a href="http://www.gurobi.com/documentation/7.5/refman/constraints.html">Gurobi</a>, <a href="https://www.ibm.com/support/knowledgecenter/SSSA5P_12.8.0/ilog.odms.cplex.help/CPLEX/UsrMan/topics/discr_optim/indicator_constr/01_indicators_title_synopsis.html">CPLEX</a>.</p>
<p>Edit 3: For more info on big M constraints and underlying issues, you can read
<a href="https://twitter.com/thserra">Thiago Serra</a>&rsquo;s <a href="https://thiagoserra.com/2017/06/15/big-m-good-in-practice-bad-in-theory-and-ugly-numerically/">post</a>, which includes nice visualizations of the problem space.</p>
<hr>
<p>Sources:</p>
<p>[1] Henrik Carøe Bylling&rsquo;s thesis, KU, <a href="http://web.math.ku.dk/noter/filer/phd19hb.pdf">http://web.math.ku.dk/noter/filer/phd19hb.pdf</a></p>

    </div>

    

<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/optimization/">optimization</a>
  
  <a class="badge badge-light" href="/tags/julia/">julia</a>
  
</div>



    
      








  





  
  
  
    
  
  
  <div class="media author-card" itemscope itemtype="http://schema.org/Person">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu717a6920346f3d435e65e27c2a66c1ed_48773_250x250_fill_q90_lanczos_center.jpg" itemprop="image" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title" itemprop="name"><a href="https://matbesancon.github.io/">Mathieu Besançon</a></h5>
      <h6 class="card-subtitle">Postdoctoral researcher 22, mathematical optimization</h6>
      <p class="card-text" itemprop="description">Mathematical optimization, scientific programming and related.</p>
      <ul class="network-icon" aria-hidden="true">
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="/#contact" >
              <i class="fas fa-envelope"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://twitter.com/matbesancon" target="_blank" rel="noopener">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://scholar.google.com/citations?user=-xStCAIAAAAJ" target="_blank" rel="noopener">
              <i class="ai ai-google-scholar"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://github.com/matbesancon" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          </li>
        
          
          
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://orcid.org/0000-0002-6284-3033" target="_blank" rel="noopener">
              <i class="ai ai-orcid"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://www.youtube.com/channel/UCVSd42nW_MqkbSXijgOvKwg" target="_blank" rel="noopener">
              <i class="fab fa-youtube"></i>
            </a>
          </li>
        
          
          
          
            
          
          
          
          
          
            
          
          <li>
            <a itemprop="sameAs" href="https://linkedin.com/in/mbesancon" target="_blank" rel="noopener">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>



      
      
      <div class="article-widget">
        <div class="hr-light"></div>
        <h3>Related</h3>
        <ul>
          
          <li><a href="/post/2018-05-25-colgen2/">The cutting stock problem: part 2, solving with column generation</a></li>
          
          <li><a href="/post/2018-05-23-colgen/">Tackling the cutting stock problem: part 1, problem exploration</a></li>
          
          <li><a href="/post/2017-12-20-diffeq-julia2/">DifferentialEquations.jl - part 2: decision from the model</a></li>
          
          <li><a href="/post/2018-12-27-heat-exchanger/">Winter warm-up: toy models for heat exchangers</a></li>
          
          <li><a href="/project/tlou/">A Bilevel Framework for Optimal Price-Setting of Time-and-Level-of-Use Tariffs</a></li>
          
        </ul>
      </div>
      
    

    

    


  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.0.0/mermaid.min.js" integrity="sha256-0w92bcB21IY5+rGI84MGj52jNfHNbXVeQLrZ0CGdjNY=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/julia.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/scala.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/rust.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/go.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/shell.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/dockerfile.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © 2021 Mathieu Besançon &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
