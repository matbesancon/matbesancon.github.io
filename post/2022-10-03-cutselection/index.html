<!DOCTYPE html>
<!-- This site was created with Wowchemy. https://www.wowchemy.com -->
<!-- Last Published: February 23, 2024 --><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.7.0 for Hugo" />
  

  
  












  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Fira+Mono&family=Fira+Sans&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Mono&family=Fira+Sans&display=swap" media="print" onload="this.media='all'">
    
  

  
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css" integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.be1e734c86be5b4f1c94d71028ea7cbf.css" />

  
  
  

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  


























  
  
  






  <meta name="author" content="Mathieu Besançon" />





  

<meta name="description" content="This is a short post on the cut selection mechanism in the mixed-integer optimization solver SCIP and things I used for its implementation in the SCIP.jl Julia wrapper. You can check out the corresponding pull request for completeness." />



<link rel="alternate" hreflang="en-us" href="https://matbesancon.xyz/post/2022-10-03-cutselection/" />
<link rel="canonical" href="https://matbesancon.xyz/post/2022-10-03-cutselection/" />



  <link rel="manifest" href="/manifest.webmanifest" />



<link rel="icon" type="image/png" href="/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  
  






<meta property="twitter:card" content="summary" />

  <meta property="twitter:site" content="@matbesancon" />
  <meta property="twitter:creator" content="@matbesancon" />
<meta property="twitter:image" content="https://matbesancon.xyz/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_512x512_fill_lanczos_center_3.png" />
<meta property="og:site_name" content="μβ" />
<meta property="og:url" content="https://matbesancon.xyz/post/2022-10-03-cutselection/" />
<meta property="og:title" content="SCIP plugins and the cut selection interface | μβ" />
<meta property="og:description" content="This is a short post on the cut selection mechanism in the mixed-integer optimization solver SCIP and things I used for its implementation in the SCIP.jl Julia wrapper. You can check out the corresponding pull request for completeness." /><meta property="og:image" content="https://matbesancon.xyz/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />

  
    <meta
      property="article:published_time"
      content="2022-10-03T00:00:00&#43;00:00"
    />
  
  
    <meta property="article:modified_time" content="2022-10-04T09:59:49&#43;02:00">
  






    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://matbesancon.xyz/post/2022-10-03-cutselection/"
  },
  "headline": "SCIP plugins and the cut selection interface",
  
  "datePublished": "2022-10-03T00:00:00Z",
  "dateModified": "2022-10-04T09:59:49+02:00",
  
  "author": {
    "@type": "Person",
    "name": "Mathieu Besançon"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "μβ",
    "logo": {
      "@type": "ImageObject",
      "url": "https://matbesancon.xyz/media/icon_hu7565e292f0a230f950fabd03a1d7dda9_12642_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "This is a short post on the cut selection mechanism in the mixed-integer optimization solver SCIP and things I used for its implementation in the SCIP.jl Julia wrapper. You can check out the corresponding pull request for completeness."
}
</script>

  

  




  
  
  

  
  

  


  
  <title>SCIP plugins and the cut selection interface | μβ</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="e6f874c2422fe3895e325265dfb9301b" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
  
  
  
  
  












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">μβ</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">μβ</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#experience"><span>Experience</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#publications"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#posts"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#workwithme"><span>Work with me</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#contact"><span>Contact</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  













  

  
  
  
<div class="article-container pt-3">
  <h1>SCIP plugins and the cut selection interface</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    2022-10-04
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  
  

  
  

</div>

    





  
</div>



  <div class="article-container">

    <div class="article-style">
      <p>This is a short post on the cut selection mechanism in the mixed-integer optimization solver
SCIP and things I used for its implementation in the <a href="https://github.com/scipopt/SCIP.jl" target="_blank" rel="noopener">SCIP.jl</a> Julia wrapper.
You can check out the corresponding <a href="https://github.com/scipopt/SCIP.jl/pull/245" target="_blank" rel="noopener">pull request</a> for completeness.</p>


<details class="toc-inpage d-print-none  " open>
  <summary class="font-weight-bold">Table of Contents</summary>
  <nav id="TableOfContents">
  <ol>
    <li><a href="#callbacks">Callbacks?</a></li>
    <li><a href="#scip-plugins">SCIP plugins</a></li>
    <li><a href="#cut-selection">Cut selection</a></li>
    <li><a href="#cut-selector-interface">Cut selector interface</a></li>
    <li><a href="#some-c-julia-magic">Some C-Julia magic</a></li>
  </ol>
</nav>
</details>

<h1 id="callbacks">Callbacks?</h1>
<p>The space of mixed-integer optimization solvers is mostly divided between
commercial, closed-source solvers and academic solvers open in source code.
In the second cluster, <a href="https://scipopt.org" target="_blank" rel="noopener">SCIP</a> stands out for the tunability of the solving
process, like all solvers through some parameters but more importantly through <em>callbacks</em>.</p>
<p>Callbacks are functions that are passed to a solver (or another function more generally) by the user
with an expected behavior.
Conceptually, they are the most elementary building block for <em>Inversion of Control</em>, letting the user
define part of the behaviour of the solver through their own code and not only through fixed parameters.</p>
<p>A basic callback system implemented in many solvers is a printing or logging callback,
the user function is called at every iteration of a solving process with some iteration-specific information to print or log,
here is a Julia example with gradient descent:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> my_solver(x0<span style="color:#f92672">::</span><span style="color:#66d9ef">AbstractVector</span>{<span style="color:#66d9ef">T</span>}, gradient_function<span style="color:#f92672">::</span><span style="color:#66d9ef">Function</span>, callback<span style="color:#f92672">::</span><span style="color:#66d9ef">Function</span>)
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> x0
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">!</span>terminated
</span></span><span style="display:flex;"><span>        g <span style="color:#f92672">=</span> gradient_function(x)
</span></span><span style="display:flex;"><span>        stepsize <span style="color:#f92672">=</span> compute_stepsize(x)
</span></span><span style="display:flex;"><span>        callback(x, g, stepsize)
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> gamma <span style="color:#f92672">*</span> g
</span></span><span style="display:flex;"><span>        terminated <span style="color:#f92672">=</span> <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>In this example, the callback is not expected to modify the solving process but contains all the information
about the current state and can record or print data.</p>
<p>The C version of it would be something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdbool.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// defining the function types
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">void</span> (<span style="color:#f92672">*</span>Gradient)(<span style="color:#66d9ef">double</span><span style="color:#f92672">*</span> gradient , <span style="color:#66d9ef">double</span><span style="color:#f92672">*</span> x);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#a6e22e">void</span> (<span style="color:#f92672">*</span>Callback)(<span style="color:#66d9ef">double</span><span style="color:#f92672">*</span> gradient , <span style="color:#66d9ef">double</span><span style="color:#f92672">*</span> x, <span style="color:#66d9ef">double</span> stepsize);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">my_solver</span>(<span style="color:#66d9ef">double</span><span style="color:#f92672">*</span> x, Gradient gradient_function, Callback callback) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span><span style="color:#f92672">*</span> gradient <span style="color:#f92672">=</span> <span style="color:#a6e22e">initialize_gradient</span>(x);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> stepsize;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">bool</span> terminated <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>terminated) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">gradient_function</span>(gradient, x);
</span></span><span style="display:flex;"><span>        stepsize <span style="color:#f92672">=</span> <span style="color:#a6e22e">compute_stepsize</span>(gradient, x);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">callback</span>(x, gradient, stepsize);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">update_iterate</span>(x, gradient, stepsize);
</span></span><span style="display:flex;"><span>        terminated <span style="color:#f92672">=</span> ...;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="scip-plugins">SCIP plugins</h1>
<p>SCIP plugins are generic interfaces for certain components of the solver such as cutting plane generators
(also called separators), heuristics, lazy constraints.
Think of plugins as a bundle of functions that have a grouped logic. Compared to callbacks,
they are another level in Inversion of Control often referred to as <em>Dependency Injection</em>.
Since C does not have a native mechanism for such a concept (think C++ abstract classes, Haskell data classes, Rust traits, Java interfaces, Scala traits),
the SCIP developers just cooked up their own with macros for the sugar of an interface.</p>
<p>SCIP plugins are listed on the page for <a href="https://www.scipopt.org/doc/html/HOWTOADD.php" target="_blank" rel="noopener">how to add them</a>.</p>
<h1 id="cut-selection">Cut selection</h1>
<p>A cut is a linear inequality $\alpha^T x \leq \beta$ such that:</p>
<ol>
<li>at least one optimal solution remains feasible with that cut (in general, cuts will not remove optimal solutions),</li>
<li>a part of the feasible region of the convex relaxation is cut off (otherwise, the cut is trivial and useless).</li>
</ol>
<p>In SCIP 8, a cut selector plugin was added, see the description in <a href="https://arxiv.org/abs/2112.08872" target="_blank" rel="noopener">the SCIP 8 release report</a>.
It was originally motivated by <a href="https://arxiv.org/abs/2202.10962" target="_blank" rel="noopener">this paper</a> including a subset of the SCIP 8 authors
on adaptive cut selection, showing that a fixed selection rule could perform poorly.</p>
<p>There is ongoing research on cut selection at ZIB and other places, having seen that smarter rules do make a difference.</p>
<p>The selection problem can be stated as follows: given a set of previously generated cuts (some might be locally valid at the current node only),
which ones should be added to the linear relaxation before continuing the branching process?</p>
<p>Instinctively, a cut should be added only if it improves the current relaxation. If the current linear programming relaxation solution
is not cut off by a cut, that cut is probably not relevant at the moment, even though it might cut off another part of the polytope.
Example of criteria currently used to determine whether a cut should be added are:</p>
<ul>
<li>efficacy: how far is the current LP relaxation from the new hyperplane,</li>
<li>sparsity: how many non-zeros coefficients does the cut have</li>
<li>orthogonality (to other constraints), a cut that is parallel to another cut means that one of them is redundant.</li>
</ul>
<p>Instead of trying to come up with fixed metrics and a fixed rule, the cut selector allows users to define their own rule
by examining all cuts and the current state of the solver.</p>
<h1 id="cut-selector-interface">Cut selector interface</h1>
<p>I will focus here on the Julia interface, some parts are very similar to what would be implemented
by a C or C++ user, except for memory management that is done automatically here.</p>
<p>The cut selector interface is pretty simple, it consists on the Julia side of</p>
<ul>
<li>a structure that needs to be a subtype of <code>AbstractCutSelector</code>,</li>
<li>one key function that has to be implemented.</li>
</ul>
<p>The low-level cut selection function that SCIP expects has the following signature,
I will give the Julia version but the C one is strictly identical:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> select_cut_lowlevel(
</span></span><span style="display:flex;"><span>    scip<span style="color:#f92672">::</span><span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP</span>},
</span></span><span style="display:flex;"><span>    cutsel_<span style="color:#f92672">::</span><span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_CUTSEL</span>},
</span></span><span style="display:flex;"><span>    cuts_<span style="color:#f92672">::</span><span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_ROW</span>}},
</span></span><span style="display:flex;"><span>    ncuts<span style="color:#f92672">::</span><span style="color:#66d9ef">Cint</span>,
</span></span><span style="display:flex;"><span>    forced_cuts_<span style="color:#f92672">::</span><span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_ROW</span>}},
</span></span><span style="display:flex;"><span>    nforced_cuts<span style="color:#f92672">::</span><span style="color:#66d9ef">Cint</span>,
</span></span><span style="display:flex;"><span>    root_<span style="color:#f92672">::</span><span style="color:#66d9ef">SCIP_Bool</span>,
</span></span><span style="display:flex;"><span>    maxnslectedcuts<span style="color:#f92672">::</span><span style="color:#66d9ef">Cint</span>,
</span></span><span style="display:flex;"><span>    nselectedcuts_<span style="color:#f92672">::</span><span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">Cint</span>},
</span></span><span style="display:flex;"><span>    result_<span style="color:#f92672">::</span><span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_RESULT</span>}
</span></span><span style="display:flex;"><span>)<span style="color:#f92672">::</span><span style="color:#66d9ef">SCIP_RETCODE</span>
</span></span></code></pre></div><p>The function takes a pointer to the SCIP model, the pointer to our cut selection plugin that
is stored within SCIP, a vector of cuts (passed as a pointer and a length),
a vector of <strong>forced</strong> cuts, that is, cuts that will be added to the linear relaxation independently of the
cut selection procedure, whether we are at the root node of the branch-and-bound tree and what is the maximum number of cuts
we are allowed to accept.</p>
<p>Forced cuts are interesting to have because they let us avoid adding redundant cuts.
This function is expected to sort the array of cuts by putting the selected cuts first
and updating the value of <code>nselectedcuts_</code> and <code>result_</code>.</p>
<p>This interface is quite low-level from a Julia perspective, and passing all arguments C-style is cumbersome.
The SCIP.jl wrapper thus lets users define their selector with a single function to implement:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> select_cuts(
</span></span><span style="display:flex;"><span>    cutsel<span style="color:#f92672">::</span><span style="color:#66d9ef">AbstractCutSelector</span>,
</span></span><span style="display:flex;"><span>    scip<span style="color:#f92672">::</span><span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_</span>},
</span></span><span style="display:flex;"><span>    cuts<span style="color:#f92672">::</span><span style="color:#66d9ef">Vector</span>{<span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_ROW</span>}},
</span></span><span style="display:flex;"><span>    forced_cuts<span style="color:#f92672">::</span><span style="color:#66d9ef">Vector</span>{<span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_ROW</span>}},
</span></span><span style="display:flex;"><span>    root<span style="color:#f92672">::</span><span style="color:#66d9ef">Bool</span>,
</span></span><span style="display:flex;"><span>    maxnslectedcuts<span style="color:#f92672">::</span><span style="color:#66d9ef">Integer</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>This function returns the output values in a tuple <code>(retcode, nselectedcuts, result)</code>
instead of passing them as arguments and lets the user manipulate vectors instead of raw pointers.
The raw function can be passed to C, but the user only see the idiomatic Julia one.
On each of the <code>Ptr{SCIP_ROW}</code>, the user can call any of the C functions, all SCIP C functions are available in
the <code>SCIP.LibSCIP</code> submodule. They can compute for instance parallelism between rows, get the number of non-zeros,
or get the coefficients $\alpha$, left and right-hand side (rows are two-sided in SCIP) and compute quantities of interest themselves.</p>
<p>Here is the complete example for a cut selector that never selects any cut:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#75715e"># the struct needs to be mutable here</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">mutable struct</span> <span style="color:#66d9ef">PickySelector</span> <span style="color:#f92672">&lt;:</span> <span style="color:#66d9ef">SCIP</span><span style="color:#f92672">.</span>AbstractCutSelector
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> SCIP<span style="color:#f92672">.</span>select_cuts(
</span></span><span style="display:flex;"><span>        cutsel<span style="color:#f92672">::</span><span style="color:#66d9ef">PickySelector</span>, scip, cuts<span style="color:#f92672">::</span><span style="color:#66d9ef">Vector</span>{<span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_ROW</span>}},
</span></span><span style="display:flex;"><span>        forced_cuts<span style="color:#f92672">::</span><span style="color:#66d9ef">Vector</span>{<span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_ROW</span>}}, root<span style="color:#f92672">::</span><span style="color:#66d9ef">Bool</span>, maxnslectedcuts<span style="color:#f92672">::</span><span style="color:#66d9ef">Integer</span>,
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># return code, number of cuts, status</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> (SCIP<span style="color:#f92672">.</span>SCIP_OKAY, <span style="color:#ae81ff">0</span>, SCIP<span style="color:#f92672">.</span>SCIP_SUCCESS)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>We have now defined a cut selector that implements the interface but SCIP does not know about it yet.
In the Julia interface, we added a wrapper function that takes care of the plumbing parts:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>cutselector <span style="color:#f92672">=</span> PickySelector()
</span></span><span style="display:flex;"><span>o <span style="color:#f92672">=</span> SCIP<span style="color:#f92672">.</span>Optimizer()
</span></span><span style="display:flex;"><span>SCIP<span style="color:#f92672">.</span>include_cutsel(o, cutselector)
</span></span></code></pre></div><h1 id="some-c-julia-magic">Some C-Julia magic</h1>
<p>The simplicity of the interface is enabled by some nice-to-have features.</p>
<p><code>@cfunction</code> lets us take a Julia function that is compatible with C, that is,
it can accept arguments that are compatible with the C type system, and produces a function pointer for it.
In our case, a function pointer is precisely what we need to pass to SCIP.
But to create a C function pointer, we need the full concrete type declared ahead of time,
<code>@cfunction</code> thus takes the return type and a tuple of the argument types to create the pointer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>func_pointer <span style="color:#f92672">=</span> <span style="color:#a6e22e">@cfunction</span>(
</span></span><span style="display:flex;"><span>    select_cut_lowlevel,
</span></span><span style="display:flex;"><span>    SCIP_RETCODE,
</span></span><span style="display:flex;"><span>    (
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_</span>}, <span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_CUTSEL</span>},
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_ROW</span>}}, <span style="color:#66d9ef">Cint</span>, <span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_ROW</span>}},
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">Cint</span>, SCIP_Bool, <span style="color:#66d9ef">Cint</span>, <span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">Cint</span>}, <span style="color:#66d9ef">Ptr</span>{<span style="color:#66d9ef">SCIP_RESULT</span>}
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>The other nice-to-have feature here is wrapping a Julia Vector around a raw data pointer without copying data,
remember that in the low-level interface, cuts are passed as a pointer and a number of elements
<code>(cuts::Ptr{Ptr{SCIP_ROW}}, ncuts::Cint)</code>.
We can wrap a <code>Vector</code> around it directly:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>cut_vector <span style="color:#f92672">=</span> unsafe_wrap(<span style="color:#66d9ef">Vector</span>, cuts, ncuts)
</span></span></code></pre></div><p>A very useful use case for this is shown in the test, one can get the cut vector, and then sort them in-place
with a custom criterion:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span>sort!(cut_vector, by<span style="color:#f92672">=</span>my_selection_criterion)
</span></span></code></pre></div><p>This will sort the elements in-place, thus modifying the array passed as a double pointer.</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/julia/">julia</a>
  
  <a class="badge badge-light" href="/tag/optimization/">optimization</a>
  
  <a class="badge badge-light" href="/tag/scip/">scip</a>
  
  <a class="badge badge-light" href="/tag/integer-optimization/">integer-optimization</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2022-10-03-cutselection%2F&amp;text=SCIP&#43;plugins&#43;and&#43;the&#43;cut&#43;selection&#43;interface" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2022-10-03-cutselection%2F&amp;t=SCIP&#43;plugins&#43;and&#43;the&#43;cut&#43;selection&#43;interface" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
        
      
      <li>
        <a href="mailto:?subject=SCIP%20plugins%20and%20the%20cut%20selection%20interface&amp;body=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2022-10-03-cutselection%2F" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2022-10-03-cutselection%2F&amp;title=SCIP&#43;plugins&#43;and&#43;the&#43;cut&#43;selection&#43;interface" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="whatsapp://send?text=SCIP&#43;plugins&#43;and&#43;the&#43;cut&#43;selection&#43;interface%20https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2022-10-03-cutselection%2F" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fmatbesancon.xyz%2Fpost%2F2022-10-03-cutselection%2F&amp;title=SCIP&#43;plugins&#43;and&#43;the&#43;cut&#43;selection&#43;interface" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://matbesancon.xyz/"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu717a6920346f3d435e65e27c2a66c1ed_48773_270x270_fill_q75_lanczos_center.jpg" alt="Mathieu Besançon"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://matbesancon.xyz/">Mathieu Besançon</a></h5>
      <h6 class="card-subtitle">Researcher in mathematical optimization</h6>
      <p class="card-text">Mathematical optimization, scientific programming and related.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/matbesancon" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=-xStCAIAAAAJ" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/matbesancon" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://orcid.org/0000-0002-6284-3033" target="_blank" rel="noopener">
        <i class="ai ai-orcid"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.youtube.com/channel/UCVSd42nW_MqkbSXijgOvKwg" target="_blank" rel="noopener">
        <i class="fab fa-youtube"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://linkedin.com/in/mbesancon" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    © 2024 Mathieu Besançon.
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-sa/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-sa fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>




    <p class="powered-by">
    Published with Hugo and Wowchemy.
   </p>


</footer>

    </div>
    
  </div>

  


<script src="/js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js"></script>




  

  
  

  













  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":true}</script>



  <script src="/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js" type="module"></script>









  
  


<script src="/en/js/wowchemy.min.2945731fa88332cb0ec33cf47d29879f.js"></script>







  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>


















</body>
</html>
